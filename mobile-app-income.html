<!DOCTYPE html><html><head><meta charset="utf-8"><title>index.html</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1><a id="____0"></a>Общие требования и соглашения</h1>
<p class="has-line-data" data-line-start="1" data-line-end="3">Запросы в систему отправляются через протокол HTTP.<br>
Все запросы и ответы - в формате JSON. Параметры в теле запроса должны начинаться с заглавной буквы в формате CamelCase.</p>
<h2 class="code-line" data-line-start=3 data-line-end=4><a id="__3"></a>адреса хостов</h2>
<ul>
<li class="has-line-data" data-line-start="4" data-line-end="5">тестовое окружения: <a href="https://dev-mobile.api.alivewater.online">https://dev-mobile.api.alivewater.online</a></li>
<li class="has-line-data" data-line-start="5" data-line-end="7">прод: <a href="https://mobile.api.alivewater.online">https://mobile.api.alivewater.online</a></li>
</ul>
<h2 class="code-line" data-line-start=7 data-line-end=8><a id="__7"></a>Подпись запросов</h2>
<p class="has-line-data" data-line-start="8" data-line-end="9">Для подписи всех запросов существует секретный ключ для Внешней системы. Каждый запрос подписывается и проверяется с использованием данного ключа. Значение подписи указывается в заголовке HTTP-запроса:</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Параметр</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td>hash</td>
<td>Хеш в виде HEX-строки. Хеш считается по конкатенации 4 строковых параметров без разделительных знаков: serviceId, dt, адрес запроса без хоста, тело запроса. Итоговая строка хешируется по алгоритму SHA1-HMAC секретным ключом.</td>
<td>Конкатенация: sid-demo1582794000/device/864626048470352/check Хеш: e87fce61f3fc5bbb3c98b0b829c9f0798000bb4d</td>
</tr>
<tr>
<td>serviceId</td>
<td>идентификатор внешней системы</td>
<td>sid-demo</td>
</tr>
<tr>
<td>dt</td>
<td>POSIX-время генерации подписи сообщения</td>
<td>1582794000</td>
</tr>
</tbody>
</table>
<p class="has-line-data" data-line-start="15" data-line-end="16">В случае, если подпись запроса будет не корректной, ответ сервера будет: http StatusCode: 401 (Unauthorized)</p>
<h1 class="code-line" data-line-start=17 data-line-end=18><a id="______17"></a>Проверка аппарата на возможность оплаты онлайн</h1>
<p class="has-line-data" data-line-start="18" data-line-end="19"><code>GET /device/{id}/check</code></p>
<blockquote>
<ul>
<li class="has-line-data" data-line-start="19" data-line-end="20">id - imei устройства</li>
</ul>
</blockquote>
<h3 class="code-line" data-line-start=20 data-line-end=21><a id="_____20"></a>Возвращает данные в случае успеха</h3>
<p class="has-line-data" data-line-start="21" data-line-end="22">Http StatusCode: 200</p>
<pre><code class="has-line-data" data-line-start="23" data-line-end="27">{
    &quot;Status&quot;: &quot;Ok&quot;
}
</code></pre>
<h3 class="code-line" data-line-start=27 data-line-end=28><a id="_27"></a>Ошибки</h3>
<p class="has-line-data" data-line-start="28" data-line-end="29">В случае, если на аппарате отключен приём оплаты онлайн</p>
<pre><code class="has-line-data" data-line-start="30" data-line-end="34">{
    &quot;Status&quot;: &quot;Disabled&quot;
}
</code></pre>
<p class="has-line-data" data-line-start="34" data-line-end="35">В случае, если аппарат не на связи</p>
<pre><code class="has-line-data" data-line-start="36" data-line-end="40">{
    &quot;Status&quot;: &quot;Offline&quot;
}
</code></pre>
<p class="has-line-data" data-line-start="40" data-line-end="42">В случае, если аппарат не найден<br>
Http StatusCode: 404</p>
<h1 class="code-line" data-line-start=43 data-line-end=44><a id="_____43"></a>Создание входящего платежа для аппарата</h1>
<p class="has-line-data" data-line-start="44" data-line-end="45"><code>POST /device/{id}/income</code></p>
<blockquote>
<ul>
<li class="has-line-data" data-line-start="45" data-line-end="46">id - imei устройства</li>
</ul>
</blockquote>
<p class="has-line-data" data-line-start="47" data-line-end="48">Данные на вход:</p>
<pre><code class="has-line-data" data-line-start="49" data-line-end="54" class="language-js">{
    <span class="hljs-string">"Sum"</span>: <span class="hljs-built_in">Number</span>, <span class="hljs-comment">// Сумма денежных средств к зачислению</span>
    <span class="hljs-string">"Qty"</span>: <span class="hljs-built_in">Number</span>, <span class="hljs-comment">// Количество литров к зачислению</span>
}
</code></pre>
<h3 class="code-line" data-line-start=55 data-line-end=56><a id="_____55"></a>Возвращает данные в случае успеха</h3>
<p class="has-line-data" data-line-start="56" data-line-end="57">Http StatusCode: 200</p>
<h1 class="code-line" data-line-start=58 data-line-end=59><a id="______58"></a>Подтверждение оплаты входящего платежа для аппарата</h1>
<p class="has-line-data" data-line-start="59" data-line-end="60"><code>PUT /income/{id}/perform</code></p>
<blockquote>
<ul>
<li class="has-line-data" data-line-start="60" data-line-end="61">id - Идентификатор платежа, полученный при создании платежа</li>
</ul>
</blockquote>
<p class="has-line-data" data-line-start="62" data-line-end="63">Данные на вход отсутствуют</p>
<h3 class="code-line" data-line-start=64 data-line-end=65><a id="_____64"></a>Возвращает данные в случае успеха</h3>
<p class="has-line-data" data-line-start="65" data-line-end="66">Http StatusCode: 204</p>
<pre><code class="has-line-data" data-line-start="67" data-line-end="69">&quot;Идентификатор платежа&quot;
</code></pre>
<h1 class="code-line" data-line-start=70 data-line-end=71><a id="___70"></a>Получение состояния платежа</h1>
<p class="has-line-data" data-line-start="71" data-line-end="72"><code>GET /income/{id}</code></p>
<blockquote>
<ul>
<li class="has-line-data" data-line-start="72" data-line-end="73">id - Идентификатор платежа, полученный при создании платежа</li>
</ul>
</blockquote>
<h3 class="code-line" data-line-start=74 data-line-end=75><a id="_____74"></a>Возвращает данные в случае успеха</h3>
<p class="has-line-data" data-line-start="75" data-line-end="76">Http StatusCode: 200</p>
<pre><code class="has-line-data" data-line-start="77" data-line-end="86">{
    &quot;Created&quot;: Number,  // POSIX-время создания платежа
    &quot;Updated&quot;: Number,  // POSIX-время обновления данных платежа
    &quot;DeviceId&quot;: String, // Imei аппарата получателя платежа
    &quot;Sum&quot;: Number,      // Сумма платежа к зачислению
    &quot;Qty&quot;: Number,      // Количество литров к зачислению
    &quot;Status&quot;: String,  // Статус платежа: created, executed
}
</code></pre>
<p class="has-line-data" data-line-start="86" data-line-end="88">В случае, если платеж не найден<br>
Http StatusCode: 404</p>
</body></html>
